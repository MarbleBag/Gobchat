<html class="chatframe">
<head>
    <meta charset="utf-8" />
    <title></title>

    <script src="lib/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="jquery-ui-1.12.1.min.css">
    <script src="lib/jquery-ui-1.12.1.min.js"></script>
    <script src="lib/lodash.min.js"></script>

    <script defer src="lib/fontawesome/js/all.js"></script>
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">-->

    <link rel="stylesheet" href="gobui_default.css">
    <link rel="stylesheet" href="gobui_chat.css">

    <link rel="stylesheet" href="_default.css">
    <link rel="stylesheet" href="ffxiv_dark_style.css">
    <style id="custome_style_id" type="text/css"></style>

    <script src="gobchat/CommonUtilFunctions.js"></script>
    <script src="gobchat/DataChannel.js"></script>
    <script src="gobchat/FFUnicodes.js"></script>

    <script src="gobchat/GobchatConfig.js"></script>

    <script src="gobchat/CommandManager.js"></script>
    <script src="gobchat/StyleBuilder.js"></script>

    <script src="gobchat/MessageSoundPlayer.js"></script>
    <script src="gobchat/MessageHtmlBuilder.js"></script>
    <script src="gobchat/GobchatManager.js"></script>

    <script src="gobchat/gob-locale.js"></script>
</head>
<body>
    <div id="container">
        <div id="chatbox" class="gob-chatbox">
            <div id="chatbox_toolba_top" class="chatbox-topbar chatbox-toolbar">
                <button id="gobchat_showconfig"><i class="fas fa-cog"></i></button>
                <button id="gobchat_togglechatsearch"><i class="fas fa-search"></i></button>
                <div id="chatbox_tabbar">
                    <div class="chatbox-tabbar-left"></div>
                    <div id="chatbox_tabbar_content"></div>
                    <div class="chatbox-tabbar-right"></div>
                </div>
            </div>
            <div id="chatbox_content" class="chatbox-content chatbox-gen">
            </div>
            <div id="chatbox_toolba_bot" class="chatbox-bottombar chatbox-gen">
                <div id="chatbox_search">
                    <input id="chatbox_search_txt" />
                    <button id="chatbox_search_hits">0 / 0</button>
                    <button id="chatbox_search_up"><i class="fas fa-angle-up"></i></button>
                    <button id="chatbox_search_down"><i class="fas fa-angle-down"></i></button>
                    <button id="chatbox_search_delete"><i class="fas fa-undo-alt"></i></button>
                    <!--<input id="chatbox_search_advanced" type="checkbox" />-->
                </div>
                <!--<gobchat-chatsearch id="chatbox_search"></gobchat-chatsearch>-->
            </div>
        </div>
    </div>
</body>

<script src="gobchat/gob-main-chatsearch.js"></script>
<script src="gobchat/gob-main-openconfig.js"></script>

<script>
    'use strict'
    //window.addEventListener('message', event => {})

    //$(window).on("message", function(e){
    //	console.log()
    //	for(let k in e){
    //		console.log(k + " | " + e[k])
    //	}
    //})

    document.addEventListener("OverlayStateUpdate", function (e) {
        if (!e.detail.isLocked)
            document.documentElement.classList.add("resize-handle");
        else
            document.documentElement.classList.remove("resize-handle");
    });

    jQuery(function ($) {
        window.chatManager = new Gobchat.GobchatManager("chatbox_content")
        window.chatManager.init()

        // test
        function runTest() {
            function fireMessageEvent(e) {
                const msg = { channel: e.channel || Gobchat.ChannelEnum.PARTY, source: e.source || "Browser", message: e.message || "Empty" }
                GobchatAPI.sendChatMessage(msg.channel, msg.source, msg.message)
            }

            const textMessages = [
                { channel: Gobchat.ChannelEnum.PARTY, message: '"Say" ((ooc)) *emote* mention' }, //base test
                { channel: Gobchat.ChannelEnum.PARTY, message: '"Mention contained in say"' },
                { channel: Gobchat.ChannelEnum.PARTY, message: '((Mention contained in ooc))' },
                { channel: Gobchat.ChannelEnum.PARTY, message: '*Mention contained in emote*' },
                { channel: Gobchat.ChannelEnum.SAY, message: '"Some speech", followed by an emote, "and some more speech."' },
                { channel: Gobchat.ChannelEnum.SAY, message: 'Display of some special html characters: < > | <<  ≫ « »' },
                { channel: Gobchat.ChannelEnum.EMOTE, message: 'Display of some special ffxiv characters: \uE0BB' },
                { channel: Gobchat.ChannelEnum.PARTY, message: '"Say that\'s divided by some *emote characters* but should still be displayed correctly."' },
                { channel: Gobchat.ChannelEnum.PARTY, message: '*An emote mixed with "for some important stuff" but contained in an emote*' },
                { channel: Gobchat.ChannelEnum.PARTY, message: 'Ooc mixed inbetween "some ((ooc)) say" *or ((ooc)) emote*' },
                { channel: Gobchat.ChannelEnum.PARTY, message: 'Ooc mixed inbetween "some ((ooc)) say" *or ((ooc)) emote*' },
                { channel: Gobchat.ChannelEnum.PARTY, message: '"Mixed stuff *inbetween but the enclosing character* was forgotten.' },
                { channel: Gobchat.ChannelEnum.PARTY, message: '»Say mixed with different types«, of symbols, »to see if they work«' },
                { channel: Gobchat.ChannelEnum.PARTY, message: '«Say mixed with different types», of symbols, «to see if they work»' },
                { channel: Gobchat.ChannelEnum.PARTY, message: 'Incomplete tokens(' },
                { channel: Gobchat.ChannelEnum.PARTY, message: 'Incomplete tokens)' },
                { channel: Gobchat.ChannelEnum.PARTY, message: '((Incomplete tokens)' },
            ]

            textMessages.forEach(e => fireMessageEvent(e))

            const fillMe = Array.from({ length: 20 }, (v, k) => `|Text1 | <Text 2> "Say" ((ooc)) *emote*   | oof |  Say, *emote* and ((ooc)) - ${k + 1} <emote> \u226Btext long\u226A`).map(e => { return { message: e, source: "Di'e I'of-oOdin" } })
            fillMe.forEach(e => fireMessageEvent(e))
        }

        //window.setTimeout(runTest, 10000);

        GobchatAPI.setUIReady(true)
    })
</script>
</html>