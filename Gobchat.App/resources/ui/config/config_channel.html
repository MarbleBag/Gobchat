<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <button class="gob-button-tertiary gob-button-copypage" id="cchannel_copyprofile"><i class="fas fa-clone"></i></button>

    <div class="gob-config-group" style="overflow-x: auto;">
        <table id="cchannel_channels" class="gob-table-channel gob-table-stripes-hrzt">
            <thead>
                <tr>
                    <th data-gob-locale-text="config.channel.tbl.name"></th>
                    <th data-gob-locale-text="config.channel.tbl.visible"></th>
                    <th data-gob-locale-text="config.channel.tbl.mention"></th>
                    <th data-gob-locale-text="config.channel.tbl.roleplay"></th>
                    <th data-gob-locale-text="config.channel.tbl.rangefilter"></th>
                    <th data-gob-locale-text="config.channel.tbl.textcolor"></th>
                    <th data-gob-locale-text="config.channel.tbl.backgroundcolor"></th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <template id="cchannel_template_channelentry">
        <tr>
            <td>
                <label class="entry-label"></label>
            </td>
            <td>
                <input class="entry-visible" type="checkbox" />
            </td>
            <td>
                <input class="entry-mention" type="checkbox" />
            </td>
            <td>
                <input class="entry-roleplay" type="checkbox" />
            </td>
            <td>
                <input class="entry-rangefilter" type="checkbox" />
            </td>
            <td>
                <div>
                    <input class="entry-color-forground" type="text" />
                    <button class="entry-color-forground-reset gob-button-tertiary gob-button-reset"
                            data-gob-locale-title="config.main.resetbutton.tooltip">
                        <i class='fas fa-undo-alt'></i>
                    </button>
                </div>
            </td>
            <td>
                <div>
                    <input class="entry-color-background" type="text" />
                    <button class="entry-color-background-reset gob-button-tertiary gob-button-reset"
                            data-gob-locale-title="config.main.resetbutton.tooltip">
                        <i class='fas fa-undo-alt'></i>
                    </button>
                </div>
            </td>
        </tr>
    </template>

    <script type="text/javascript">
        'use strict';

        (function (undefined) {
            const binding = GobConfigHelper.makeDatabinding(gobconfig)

            const table = $("#cchannel_channels > tbody")
            const rowTemplate = $('#cchannel_template_channelentry')

            function buildChannelEntry(channelData) {
                const rowEntry = $(rowTemplate.html()).appendTo(table)

                const lblName = rowEntry.find(".entry-label")
                const chkVisible = rowEntry.find(".entry-visible")
                const chkMention = rowEntry.find(".entry-mention")
                const chkRoleplay = rowEntry.find(".entry-roleplay")
                const chkRangefilter = rowEntry.find(".entry-rangefilter")
                const clrSelectorFG = rowEntry.find(".entry-color-forground")
                const btnResetFG = rowEntry.find(".entry-color-forground-reset")
                const clrSelectorBG = rowEntry.find(".entry-color-background")
                const btnResetBG = rowEntry.find(".entry-color-background-reset")

                lblName.attr("data-gob-locale-text", `${channelData.translationId}`)
                lblName.attr("data-gob-locale-title", `${channelData.translationId}.tooltip`)

                GobConfigHelper.setConfigKey(chkVisible, "behaviour.channel.visible")
                GobConfigHelper.setConfigKey(chkMention, "behaviour.channel.mention")
                GobConfigHelper.setConfigKey(chkRoleplay, "behaviour.channel.roleplay")
                GobConfigHelper.setConfigKey(chkRangefilter, "behaviour.channel.rangefilter")

                const channelEnums = [].concat(channelData.chatChannel || [])
                if (channelEnums.length === 0) {
                    chkVisible.hide()
                    chkMention.hide()
                    chkRoleplay.hide()
                    chkRangefilter.hide()
                } else {
                    GobConfigHelper.bindCheckboxArray(binding, chkVisible, channelEnums)
                    GobConfigHelper.bindCheckboxArray(binding, chkMention, channelEnums)
                    GobConfigHelper.bindCheckboxArray(binding, chkRoleplay, channelEnums)
                    GobConfigHelper.bindCheckboxArray(binding, chkRangefilter, channelEnums)
                }

                if (channelData.configId === null) {
                    clrSelectorFG.parent().hide()
                    clrSelectorBG.parent().hide()
                } else {
                    GobConfigHelper.setConfigKey(clrSelectorFG, channelData.configId + ".color")
                    GobConfigHelper.setConfigKey(clrSelectorBG, channelData.configId + ".background-color")

                    GobConfigHelper.makeColorSelector(clrSelectorFG)
                    GobConfigHelper.makeColorSelector(clrSelectorBG)

                    GobConfigHelper.bindColorSelector(binding, clrSelectorFG)
                    GobConfigHelper.bindColorSelector(binding, clrSelectorBG)

                    btnResetFG.attr("disabled", clrSelectorFG.attr("disabled"))
                    btnResetBG.attr("disabled", clrSelectorBG.attr("disabled"))
                    btnResetFG.on("click", event => gobconfig.reset(GobConfigHelper.getConfigKey(clrSelectorFG)))
                    btnResetBG.on("click", event => gobconfig.reset(GobConfigHelper.getConfigKey(clrSelectorBG)))
                }
            }

            buildChannelEntry({
                translationId: "main.chat.channel.general",
                configId: "style.channel.base",
                relevant: true
            })

            Object.entries(Gobchat.Channels).forEach((entry) => {
                const channelData = entry[1]
                if (!channelData.relevant)
                    return
                buildChannelEntry(channelData)
            })

            binding.initialize()

            const btnCopyProfile = $("#cchannel_copyprofile")
            const copyKeys = ["behaviour.channel.visible", "behaviour.channel.mention", "behaviour.channel.roleplay", "behaviour.channel.rangefilter"]
            copyKeys.push("style.channel.base" + ".color")
            copyKeys.push("style.channel.base" + ".background-color")

            Object.entries(Gobchat.Channels).forEach((entry) => {
                const channelData = entry[1]
                if (!channelData.relevant || channelData.configId == null) return
                copyKeys.push(channelData.configId + ".color")
                copyKeys.push(channelData.configId + ".background-color")
            })

            GobConfigHelper.makeCopyProfileButton(btnCopyProfile, { configKeys: copyKeys })

        }());
    </script>
</body>
</html>