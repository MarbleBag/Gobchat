<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <button class="ui-btn-copyprofile" id="cchannel_copyprofile"><i class="fas fa-clone"></i></button>

    <p>
        <div></div>
    </p>
    <p>
        <table id="cchannel_channels">
            <thead>
                <tr>
                    <th data-gob-locale-text="config.channel.tbl.name"></th>
                    <th data-gob-locale-text="config.channel.tbl.visible"></th>
                    <th data-gob-locale-text="config.channel.tbl.mention"></th>
                    <th data-gob-locale-text="config.channel.tbl.roleplay"></th>
                    <th data-gob-locale-text="config.channel.tbl.rangefilter"></th>
                    <th data-gob-locale-text="config.channel.tbl.textcolor"></th>
                    <th data-gob-locale-text="config.channel.tbl.backgroundcolor"></th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </p>

    <template id="cchannel_template_channelentry">
        <tr>
            <td>
                <label class="entry-label"></label>
            </td>
            <td>
                <input class="entry-visible" type="checkbox" />
            </td>
            <td>
                <input class="entry-mention" type="checkbox" />
            </td>
            <td>
                <input class="entry-roleplay" type="checkbox" />
            </td>
            <td>
                <input class="entry-rangefilter" type="checkbox" />
            </td>
            <td>
                <div>
                    <input class="entry-color-forground" type="text" />
                    <button class="entry-color-forground-reset ui-gc-btn"
                            data-gob-locale-title="config.main.resetbutton.tooltip">
                        <i class='fas fa-undo-alt'></i>
                    </button>
                </div>
            </td>
            <td>
                <div>
                    <input class="entry-color-background" type="text" />
                    <button class="entry-color-background-reset ui-gc-btn"
                            data-gob-locale-title="config.main.resetbutton.tooltip">
                        <i class='fas fa-undo-alt'></i>
                    </button>
                </div>
            </td>
        </tr>
    </template>

    <script type="text/javascript">
        'use strict';

        (function (undefined) {
            const channels = [
                { channel: null, translationId: "main.chat.channel.general", styleId: "style.channel.base" },
                { label: "general", channelEnum: null, styleId: "style.channel.base" },

                { channel: Gobchat.Channels.SAY, styleId: "style.channel.base" },
                { label: "say", channelEnum: "SAY", styleId: "style.channel.say" },
                { label: "emote", channelEnum: "EMOTE", styleId: "style.channel.emote" },
                { label: "yell", channelEnum: "YELL", styleId: "style.channel.yell" },
                { label: "shout", channelEnum: "SHOUT", styleId: "style.channel.shout" },
                { label: "party", channelEnum: "PARTY", styleId: "style.channel.party" },
                { label: "guild", channelEnum: "GUILD", styleId: "style.channel.guild" },
                { label: "tellsend", channelEnum: "TELL_SEND", styleId: "style.channel.tellsend" },
                { label: "tellrecieve", channelEnum: "TELL_RECIEVE", styleId: "style.channel.tellrecieve" },
                { label: "alliance", channelEnum: "ALLIANCE", styleId: "style.channel.alliance" },
                { label: "npc-dialog", channelEnum: ["NPC_TALK", "NPC_DIALOGUE"], styleId: "style.channel.npc-dialog" },
                { label: "animated-emote", channelEnum: "ANIMATED_EMOTE", styleId: "style.channel.animated-emote" },
                { label: "echo", channelEnum: "ECHO", styleId: "style.channel.echo" },
                { label: "roll", channelEnum: ["RANDOM_SELF", "RANDOM_PARTY", "RANDOM_OTHER"], styleId: "style.channel.roll" },
                { label: "error", channelEnum: "ERROR", styleId: "style.channel.error" },

                { label: "gobinfo", channelEnum: "GOBCHAT_INFO", styleId: "style.channel.gobchatinfo" },
                { label: "goberror", channelEnum: "GOBCHAT_ERROR", styleId: "style.channel.gobchaterror" },

                { label: "linkshell1", channelEnum: "LINKSHELL_1", styleId: "style.channel.linkshell-1" },
                { label: "linkshell2", channelEnum: "LINKSHELL_2", styleId: "style.channel.linkshell-2" },
                { label: "linkshell3", channelEnum: "LINKSHELL_3", styleId: "style.channel.linkshell-3" },
                { label: "linkshell4", channelEnum: "LINKSHELL_4", styleId: "style.channel.linkshell-4" },
                { label: "linkshell5", channelEnum: "LINKSHELL_5", styleId: "style.channel.linkshell-5" },
                { label: "linkshell6", channelEnum: "LINKSHELL_6", styleId: "style.channel.linkshell-6" },
                { label: "linkshell7", channelEnum: "LINKSHELL_7", styleId: "style.channel.linkshell-7" },
                { label: "linkshell8", channelEnum: "LINKSHELL_8", styleId: "style.channel.linkshell-8" },

                { label: "worldlinkshell1", channelEnum: "WORLD_LINKSHELL_1", styleId: "style.channel.worldlinkshell-1" },
                { label: "worldlinkshell2", channelEnum: "WORLD_LINKSHELL_2", styleId: "style.channel.worldlinkshell-2" },
                { label: "worldlinkshell3", channelEnum: "WORLD_LINKSHELL_3", styleId: "style.channel.worldlinkshell-3" },
                { label: "worldlinkshell4", channelEnum: "WORLD_LINKSHELL_4", styleId: "style.channel.worldlinkshell-4" },
                { label: "worldlinkshell5", channelEnum: "WORLD_LINKSHELL_5", styleId: "style.channel.worldlinkshell-5" },
                { label: "worldlinkshell6", channelEnum: "WORLD_LINKSHELL_6", styleId: "style.channel.worldlinkshell-6" },
                { label: "worldlinkshell7", channelEnum: "WORLD_LINKSHELL_7", styleId: "style.channel.worldlinkshell-7" },
                { label: "worldlinkshell8", channelEnum: "WORLD_LINKSHELL_8", styleId: "style.channel.worldlinkshell-8" },
            ]

            const binding = GobConfigHelper.makeDatabinding(gobconfig)

            const table = $("#cchannel_channels > tbody")
            const rowTemplate = $('#cchannel_template_channelentry')

            function buildChannelEntry(channelData) {
                const rowEntry = $(rowTemplate.html()).appendTo(table)

                const lblName = rowEntry.find(".entry-label")
                const chkVisible = rowEntry.find(".entry-visible")
                const chkMention = rowEntry.find(".entry-mention")
                const chkRoleplay = rowEntry.find(".entry-roleplay")
                const chkRangefilter = rowEntry.find(".entry-rangefilter")
                const clrSelectorFG = rowEntry.find(".entry-color-forground")
                const btnResetFG = rowEntry.find(".entry-color-forground-reset")
                const clrSelectorBG = rowEntry.find(".entry-color-background")
                const btnResetBG = rowEntry.find(".entry-color-background-reset")

                lblName.attr("data-gob-locale-text", `${channelData.translationId}`)
                lblName.attr("data-gob-locale-title", `${channelData.translationId}.tooltip`)

                GobConfigHelper.setConfigKey(chkVisible, "behaviour.channel.visible")
                GobConfigHelper.setConfigKey(chkMention, "behaviour.channel.mention")
                GobConfigHelper.setConfigKey(chkRoleplay, "behaviour.channel.roleplay")
                GobConfigHelper.setConfigKey(chkRangefilter, "behaviour.channel.rangefilter")

                const channelEnums = [].concat(channelData.chatChannel || [])
                if (channelEnums.length === 0) {
                    chkVisible.hide()
                    chkMention.hide()
                    chkRoleplay.hide()
                    chkRangefilter.hide()
                } else {
                    GobConfigHelper.bindCheckboxArray(binding, chkVisible, channelEnums)
                    GobConfigHelper.bindCheckboxArray(binding, chkMention, channelEnums)
                    GobConfigHelper.bindCheckboxArray(binding, chkRoleplay, channelEnums)
                    GobConfigHelper.bindCheckboxArray(binding, chkRangefilter, channelEnums)
                }

                if (channelData.configId === null) {
                    clrSelectorFG.parent().hide()
                    clrSelectorBG.parent().hide()
                } else {
                    GobConfigHelper.setConfigKey(clrSelectorFG, channelData.configId + ".color")
                    GobConfigHelper.setConfigKey(clrSelectorBG, channelData.configId + ".background-color")

                    GobConfigHelper.makeColorSelector(clrSelectorFG)
                    GobConfigHelper.makeColorSelector(clrSelectorBG)

                    GobConfigHelper.bindColorSelector(binding, clrSelectorFG)
                    GobConfigHelper.bindColorSelector(binding, clrSelectorBG)

                    btnResetFG.attr("disabled", clrSelectorFG.attr("disabled"))
                    btnResetBG.attr("disabled", clrSelectorBG.attr("disabled"))
                    btnResetFG.on("click", event => gobconfig.reset(GobConfigHelper.getConfigKey(clrSelectorFG)))
                    btnResetBG.on("click", event => gobconfig.reset(GobConfigHelper.getConfigKey(clrSelectorBG)))
                }
            }

            buildChannelEntry({
                translationId: "main.chat.channel.general",
                configId: "style.channel.base",
                relevant: true
            })

            Object.entries(Gobchat.Channels).forEach((entry) => {
                const channelData = entry[1]
                if(!channelData.relevant)
                    return
                buildChannelEntry(channelData)
            })

            binding.initialize()

            const btnCopyProfile = $("#cchannel_copyprofile")
            const copyKeys = ["behaviour.channel.visible", "behaviour.channel.mention", "behaviour.channel.roleplay"]
            channels.forEach(entry => {
                if (entry.styleId === undefined || entry.styleId === null) return
                copyKeys.push(entry.styleId + ".color")
                copyKeys.push(entry.styleId + ".background-color")
            })
            GobConfigHelper.makeCopyProfileButton(btnCopyProfile, { configKeys: copyKeys })

        }());
    </script>
</body>
</html>