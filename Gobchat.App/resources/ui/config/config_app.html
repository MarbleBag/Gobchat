<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
</head>
<body>
    <button class="ui-btn-copyprofile" id="capp_copyprofile"><i class="fas fa-clone"></i></button>

    <p>
        <div>
            <label>Language</label>
            <select id="capp_language" data-gob-configkey="behaviour.language" disabled="true" title="Soon (TM)">
                <option value="en">English</option>
                <option value="de">Deutsch</option>
            </select>
        </div>
    </p>

    <p>
        <div>
            <table>
                <thead>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <label>Make a chat log</label>
                        </td>
                        <td>
                            <input type="checkbox" id="capp_makechatlog" data-gob-configkey="behaviour.writeChatLog" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Autodetect emotes in say channel</label>
                        </td>
                        <td>
                            <input type="checkbox" id="capp_autodetectemote" data-gob-configkey="behaviour.autodetectEmoteInSay" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Show timestamp</label>
                        </td>
                        <td>
                            <input type="checkbox" id="capp_showTimestamp" data-gob-configkey="behaviour.showTimestamp" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Hide when FF is minimized (Beta)</label>
                        </td>
                        <td>
                            <input type="checkbox" id="capp_hide" data-gob-configkey="behaviour.hideOnMinimize" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Check for updates on start</label>
                        </td>
                        <td>
                            <input type="checkbox" id="capp_checkupdates" data-gob-configkey="behaviour.checkForUpdate" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="capp_checkbetaupdates">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- allow beta updates</label>
                        </td>
                        <td>
                            <input type="checkbox" id="capp_checkbetaupdates" data-gob-configkey="behaviour.checkForBetaUpdate" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </p>

    <p>
        <div hidden>
            <label>Chat position and size</label>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label>X: </label>
                            <input type="number" data-gob-configkey="behaviour.frame.chat.position.x" />
                        </td>
                        <td>
                            <label>Hight: </label>
                            <input type="number" data-gob-configkey="behaviour.frame.chat.size.height" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Y: </label>
                            <input type="number" data-gob-configkey="behaviour.frame.chat.position.y" />
                        </td>
                        <td>
                            <label>Width: </label>
                            <input type="number" data-gob-configkey="behaviour.frame.chat.size.width" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </p>

    <p>
        <div>
            <label>Fonts:</label>
            <input type="text" id="capp_font_family" data-gob-configkey="style.channel.base.font-family" style="width:100%;">
            <button class="ui-gc-btn" id="capp_font_family_reset"><i class="fas fa-undo-alt"></i></button>
        </div>
    </p>

    <p>
        <div>
            <label>Font size:</label>
            <select id="capp_font_size" data-gob-configkey="style.channel.base.font-size">
                <option value="small">Small</option>
                <option value="medium">Medium</option>
                <option value="large">Large</option>
            </select>
        </div>
    </p>

    <p>
        <div>
            <label>Hotkeys:</label>
        </div>
        <div>
            <label>Hide &amp; show chat overlay</label>
        </div>
        <div>
            <input type="text" id="capp_hotkey_show" data-gob-configkey="behaviour.hotkeys.showhide" />
        </div>
        <div>
            <label>Text Search</label>
        </div>
        <div>
            <input type="text" id="capp_hotkey_search" data-gob-configkey="behaviour.hotkeys.search" />
        </div>
    </p>

    <p>
        <div>
            <label>Chat Update Interval (MS)</label>
            <input type="number" min="0" max="5000" id="capp_updateInterval" data-gob-configkey="behaviour.chatUpdateInterval" />
        </div>
        <div hidden>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label>Ignore outdated messages (In seconds)</label>
                        </td>
                        <td>
                            <input type="checkbox" id="capp_" data-gob-configkey="behaviour.outdatedMessages.ignore" title="" />
                        </td>
                        <td>
                            <input type="number" id="capp_" min="5" data-gob-configkey="behaviour.outdatedMessages.timelimit" title="" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Show number of outdated messages</label>
                        </td>
                        <td>
                            <input type="checkbox" title="" id="capp_" data-gob-configkey="behaviour.outdatedMessages.showUser" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </p>

    <script type="text/javascript">
        'use strict';

        (function () {
            // setup language
            const dpdLanguage = $("#capp_language")
            ConfigHelper.linkDropdownConfig(dpdLanguage, { defaultValue: "en" })

            // setup checkboxes
            const ckbChatLog = $("#capp_makechatlog")
            ckbChatLog.attr("title", "Gobchat creates a chatlog which will be saved under AppData\\Roaming\\Gobchat\\log")
            ConfigHelper.linkCheckboxConfig(ckbChatLog)

            const ckbAutodetect = $("#capp_autodetectemote")
            ConfigHelper.linkCheckboxConfig(ckbAutodetect)

            const ckbTimestamp = $("#capp_showTimestamp")
            ConfigHelper.linkCheckboxConfig(ckbTimestamp)

            const ckbHide = $("#capp_hide")
            ckbHide.attr("title", "Hides Gobchat when FFXIV gets minimized and shows Gobchat when FFXIV gets maximized")
            ConfigHelper.linkCheckboxConfig(ckbHide)

            const ckbUpdate = $("#capp_checkupdates")
            ConfigHelper.linkCheckboxConfig(ckbUpdate)

            const ckbBetaUpdate = $("#capp_checkbetaupdates")
            ConfigHelper.linkCheckboxConfig(ckbBetaUpdate)
            const ckbBetaUpdateLabel = $("[for='capp_checkbetaupdates']")
            ConfigHelper.setupListener(ckbUpdate.attr(ConfigHelper.ConfigKeyAttribute), value => {
                ckbBetaUpdate.attr("disabled", !value)
                ckbBetaUpdateLabel.toggleClass("disabled", !value)
            })
            ckbBetaUpdate.attr("disabled", !ckbUpdate.prop("checked"))
            ckbBetaUpdateLabel.toggleClass("disabled", !ckbUpdate.prop("checked"))

            // setup font group
            // setup font family
            const txtFontFamily = $("#capp_font_family")
            txtFontFamily.attr("title", "Picks the first available font, from left to right. It's also possible to use a 'generic font': serif, sans-serife, monospace.")
            ConfigHelper.linkTextConfig(txtFontFamily)

            const btnFontFamilyReset = $("#capp_font_family_reset")
            btnFontFamilyReset.attr("title", "Resets fonts to its default value")
            btnFontFamilyReset.on("click", (event) => {
                const configKey = txtFontFamily.attr(ConfigHelper.ConfigKeyAttribute)
                if (configKey) gobconfig.reset(configKey)
            })

            // setup font size
            const dpdFontSize = $("#capp_font_size")
            const dpdFonSizeConfigKey = dpdFontSize.attr(ConfigHelper.ConfigKeyAttribute)
            ConfigHelper.setupListenerAndInitialize(dpdFonSizeConfigKey, value => dpdFontSize.val(value))
            dpdFontSize.on("change", function (event) {
                let newSize = event.target.value || "medium"
                if (Gobchat.isNumber(newSize))
                    newSize = Math.round(newSize) + "px"
                gobconfig.set(dpdFonSizeConfigKey, newSize)
            })

            // setup hotkey group
            // setup hotkey field
            const txtHotkeyShow = $("#capp_hotkey_show")
            txtHotkeyShow.attr("title", "Hides or shows gobchat on keypress")
            const txtHotkeyShowConfigKey = txtHotkeyShow.attr(ConfigHelper.ConfigKeyAttribute)
            ConfigHelper.setupListenerAndInitialize(txtHotkeyShowConfigKey, value => txtHotkeyShow.val(value), { defValue: "" })
            txtHotkeyShow.on("keydown", function (event) {
                //needs a way to transform the stored code into javascript and back
                //this may create some problems for some very special keys

                const keyMsg = ConfigHelper.decodeHotkey(event, true);
                if (keyMsg === null)
                    return

                txtHotkeyShow.val(keyMsg)
                gobconfig.set(txtHotkeyShowConfigKey, keyMsg)
            })

            const txtHotkeySearch = $("#capp_hotkey_search")
            txtHotkeySearch.attr("title", "Hides or shows a text search field")
            const txtHotkeySearchConfigKey = txtHotkeySearch.attr(ConfigHelper.ConfigKeyAttribute)
            ConfigHelper.setupListenerAndInitialize(txtHotkeySearchConfigKey, value => txtHotkeySearch.val(value), { defValue: "" })
            txtHotkeySearch.on("keydown", function (event) {
                const keyMsg = ConfigHelper.decodeHotkey(event, true);
                if (keyMsg === null)
                    return

                txtHotkeySearch.val(keyMsg)
                gobconfig.set(txtHotkeySearchConfigKey, keyMsg)
            })

            // setup ungrouped

            const txtUpdateInterval = $("#capp_updateInterval")
            const txtUpdateIntervalConfigKey = txtUpdateInterval.attr(ConfigHelper.ConfigKeyAttribute)
            txtUpdateInterval.attr("title", "Amount of milliseconds to wait between two updates of the chat overlay. A value of 1000 means one update per second. A value of 2000 means one update every two seconds. A value of 500 means two updates per second.")
            ConfigHelper.setupListenerAndInitialize(txtUpdateIntervalConfigKey, value => txtUpdateInterval.val(value), { defValue: "1000" })
            txtUpdateInterval.on("change", function (event) {
                let newValue = event.target.value || 100
                if (newValue < 0) newValue = 0
                else if (newValue > 5000) newValue = 5000

                txtUpdateInterval.val(newValue)
                gobconfig.set(txtUpdateIntervalConfigKey, newValue)
            })

            const allFields = [
                dpdLanguage,
                ckbChatLog, ckbAutodetect, ckbTimestamp, ckbHide, ckbUpdate, ckbBetaUpdate,
                txtFontFamily, dpdFontSize,
                txtHotkeyShow,
                txtUpdateInterval
            ]

            const btnCopyProfile = $("#capp_copyprofile")
            ConfigHelper.makeCopyProfileButton(btnCopyProfile,
                {
                    configKeys: _.map(allFields, e => e.attr(ConfigHelper.ConfigKeyAttribute))
                })

        }());
    </script>
</body>
</html>