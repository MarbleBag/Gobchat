<html>
<head>
	<meta charset="utf-16" />
	<title></title>

	<link rel="stylesheet" href="defaults.css">
	<link rel="stylesheet" href="chat.css">
	<style id="custome_style_id" type="text/css"></style>

	<script src="lib/jquery-3.4.1.min.js"></script>
	<link rel="stylesheet" href="jquery-ui-1.12.1.min.css">
	<script src="lib/jquery-ui-1.12.1.min.js"></script>
	<script src="lib/lodash.min.js"></script>

	<link rel="stylesheet" href="resize_handle.css">
	<script src="resize_handle.js"></script>
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<script src="gobchat/Datacenters.js"></script>
	<script src="gobchat/Channels.js"></script>
	<script src="gobchat/FFUnicodes.js"></script>
	<script src="gobchat/DefaultConfig.js"></script>
	<script src="gobchat/Common.js"></script>	  

	<script src="gobchat/DataObjects.js"></script>  

	<script src="gobchat/GobchatConfig.js"></script>  
	<script src="gobchat/StyleBuilder.js"></script>  
	<script src="gobchat/MessageParser.js"></script>
	<script src="gobchat/MessageHtmlBuilder.js"></script>  
	<script src="gobchat/CommandManager.js"></script>
	<script src="gobchat/GobchatManager.js"></script>

</head>
<body>
	<!-- 
		TODO:
		- transparency needs to be done via background-image, this version of Xilium does not support rgba 
		- transparency can be done by using rgba(r,g,b,a) in CSS
		-  Scrollbar which stays at its current position, except if its all the way down, where it will follow the chat
		- (saveable) Settings
		- Maybe let parsing be done im c# plugin for performance?
		- Store some MB of chat history im plugin for retrieval on reload
		- clear command		
	-->
	
	<div id="container">
		<div id="chatbox" class="chatbox">
			<div id="toolbar" class="chatbox-topbar">
				<div class="chatbox-toolbar">
					<button id="gobchat_config"><i class="fa fa-gear"></i></button>
				</div>
				<div id="toolbarTabs" class="chatbox-tabs">
				</div>
			</div>
			<div class="chatbox-content-container chatbox-gen">
				<div id="chatboxcontent" class="chatbox-content">
				</div>
			</div>

		</div>
	</div>
</body>

<script>
	'use strict'
	//window.addEventListener('message', event => {})	  
	
	//$(window).on("message", function(e){
	//	console.log()
	//	for(let k in e){
	//		console.log(k + " | " + e[k])
	//	}		
	//})
	
	jQuery(function ($) {
		window.chatManager = new Gobchat.GobchatManager("chatboxcontent")
		window.chatManager.init()
						
		$("#gobchat_config").on("click",function(e){
			window.chatManager.saveConfigToLocalStore()			
			const handle = window.open('gobconfig.html','Settings','width=900,height=600')		
			handle.focus()
		})
		
		$(window).on("message",function(e){
			//TODO somehow check for the correct data
			window.chatManager.loadConfigFromLocalStore()
			window.chatManager.updateStyle()
		})
				
		// test
		function runTest(){
			const fillMe = Array.from({length: 1}, (v, k) => `Say, *emote* and ((ooc)) - ${k+1}`).map(e =>{return {message: e, source:"\u2605Firstname LastnameOdin"}})
			fillMe.forEach((e)=>{
					const msg = {detail:{type: e.channel || Gobchat.ChannelEnum.SAY, timestamp:"HH:mm", source: e.source || "Browser", message: e.message || "Empty"}}
					window.chatManager.onNewMessageEvent(msg)
				})
		}
		
		//window.setTimeout( runTest, 5000 );
		
	})
</script>
</html>
